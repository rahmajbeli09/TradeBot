# ChatbotNaSoft - Documentation Technique

## üìã Vue d'ensemble du projet

ChatbotNaSoft est une solution intelligente de traitement de feeds qui automatise l'analyse, l'anonymisation et la cat√©gorisation des messages par type (msg-type) en utilisant l'intelligence artificielle Gemini de Google.

## üéØ Objectif principal

D√©tecter automatiquement les msg-types inconnus dans les fichiers feeds, analyser leur structure avec l'IA Gemini, et stocker les mappings pour un traitement futur sans anonymisation.

## üèóÔ∏è Architecture du syst√®me

### Fichiers principaux et leur utilit√©

#### 1. **Fichiers de configuration**
- `application.yml` : Configuration centrale (API Gemini, MongoDB, surveillance fichiers)
- `GeminiProperties.java` : Gestion des propri√©t√©s de l'API Gemini
- `ServiceConfiguration.java` : Configuration des services Spring

#### 2. **Entit√©s et DTO**
- `Feed.java` : Entit√© MongoDB pour les feeds connus
- `FeedMapping.java` : Entit√© MongoDB pour stocker les mappings LLM
- `FieldMapping.java` : DTO pour repr√©senter un mapping de champs
- `LLMAnalysisResult.java` : DTO pour encapsuler les r√©sultats d'analyse
- `AnonymizedLine.java` : DTO pour les lignes anonymis√©es
- `AnonymizationResult.java` : DTO pour les r√©sultats d'anonymisation

#### 3. **Services m√©tier**
- `FileWatcherService.java` : Surveillance automatique du r√©pertoire input/feeds
- `FileStabilizationService.java` : Stabilisation des fichiers avant traitement
- `FileReadingService.java` : Lecture streaming des fichiers
- `FeedParsingService.java` : Parsing et regroupement par msg-type
- `FeedDetectionService.java` : D√©tection des msg-types connus/inconnus
- `AnonymizationService.java` : Anonymisation des champs sensibles
- `LLMService.java` : Service d'analyse avec Gemini API
- `FeedMappingService.java` : Gestion des mappings en base de donn√©es
- `FeedProcessingService.java` : Orchestrateur principal du pipeline

#### 4. **Repositories**
- `FeedRepository.java` : Acc√®s aux donn√©es des feeds
- `FeedMappingRepository.java` : Acc√®s aux mappings LLM

#### 5. **Controllers REST**
- `LLMController.java` : API pour l'analyse LLM manuelle
- `AnonymizationController.java` : API pour l'anonymisation
- `FeedMappingController.java` : API pour la gestion des mappings

## üîÑ Proc√©dure compl√®te de traitement

### √âtape 1 : D√©tection et stabilisation des fichiers
```
Fichier d√©pos√© dans input/feeds
       ‚Üì
FileWatcherService d√©tecte le nouveau fichier
       ‚Üì
FileStabilizationService attend 5 secondes (configurable)
       ‚Üì
Fichier marqu√© comme "pr√™t pour traitement"
```

### √âtape 2 : Lecture et parsing
```
FileReadingService lit le fichier en streaming
       ‚Üì
FeedParsingService extrait le msg-type (2√®me champ s√©par√© par ;)
       ‚Üì
Regroupement des lignes par msg-type
       ‚Üì
Cr√©ation de ParsedFeedGroup par msg-type
```

### √âtape 3 : D√©tection et anonymisation
```
FeedDetectionService v√©rifie chaque msg-type dans MongoDB
       ‚Üì
Si msg-type INCONNU ‚Üí AnonymizationService
       ‚Üì
Remplacement des champs 3+ par "xxxxx" (conservation 2 premiers champs)
       ‚Üì
Si msg-type CONNU ‚Üí Pas d'anonymisation
```

### √âtape 4 : Analyse LLM intelligente
```
LLMService analyse les msg-types inconnus
       ‚Üì
Appel √† Gemini API avec gemini-2.5-flash (1M tokens)
       ‚Üì
Fallback vers gemini-2.0-flash si n√©cessaire
       ‚Üì
G√©n√©ration de JSON structur√© : {"Champ 1": "Signification", ...}
       ‚Üì
Cr√©ation des FieldMapping par msg-type
```

### √âtape 5 : Stockage et d√©duplication
```
FeedMappingService stocke les r√©sultats
       ‚Üì
V√©rification d'existence par msg-type (√©vite doublons)
       ‚Üì
Stockage dans collection "feed_mapping" MongoDB
       ‚Üì
Cr√©ation automatique des feeds pour msg-types futurs
```

## üõ†Ô∏è Configuration technique

### API Gemini
- **Mod√®le principal** : gemini-2.5-flash (1M tokens, 65K output)
- **Fallback** : gemini-2.0-flash (1M tokens, 8K output)
- **Temperature** : 0.7 (√©quilibre cr√©ativit√©/pr√©cision)
- **Max tokens** : 2048

### MongoDB
- **Base** : chatbot
- **Collections** : feed (msg-types), feed_mapping (mappings LLM)
- **Index** : Unique sur msgType pour √©viter les doublons

### Surveillance fichiers
- **R√©pertoire** : input/feeds (cr√©√© automatiquement)
- **Pattern** : FEED*.txt (accepte FEED_ et FEED_V2*)
- **D√©lai** : 5 secondes (configurable)

## üìä Utilit√© de chaque composant

### Pipeline de traitement automatis√©
- **FileWatcherService** : Surveillance temps r√©el des nouveaux fichiers
- **FeedProcessingService** : Orchestration compl√®te du pipeline
- **AnonymizationService** : Protection des donn√©es sensibles

### Intelligence artificielle
- **LLMService** : Analyse s√©mantique des structures de donn√©es
- **FieldMapping** : Structuration automatique des connaissances

### Gestion des donn√©es
- **FeedMappingService** : Persistence et d√©duplication intelligente
- **MongoDB** : Stockage NoSQL scalable et performant

### API REST
- **FeedMappingController** : Interface pour consulter/g√©rer les mappings
- **LLMController** : Interface pour analyses manuelles
- **AnonymizationController** : Interface pour anonymisation √† la demande

## üéØ Avantages du syst√®me

### 1. **Automatisation compl√®te**
- D√©tection automatique des nouveaux fichiers
- Traitement sans intervention manuelle
- Apprentissage continu des nouveaux msg-types

### 2. **S√©curit√© des donn√©es**
- Anonymisation automatique des donn√©es sensibles
- Conservation structurelle pour l'analyse
- Tra√ßabilit√© compl√®te des traitements

### 3. **Intelligence adaptative**
- Analyse par IA des structures inconnues
- Cr√©ation automatique de mappings r√©utilisables
- Fallback robuste en cas d'√©chec

### 4. **Scalabilit√©**
- Architecture microservices
- Base de donn√©es NoSQL
- API REST pour int√©gration externe

## üöÄ R√©sultats obtenus

Le syst√®me traite avec succ√®s les fichiers feeds et :
- D√©tecte automatiquement les msg-types inconnus
- G√©n√®re des mappings structur√©s via IA
- Stocke les connaissances pour r√©utilisation future
- Fournit une interface REST pour consultation

## üìà √âvolutions possibles

1. **Interface web** pour consultation des mappings
2. **Tableau de bord** de monitoring des traitements
3. **Export/Import** des configurations de mappings
4. **Support multi-formats** au-del√† des fichiers texte
5. **ML avanc√©** pour pr√©diction de msg-types

---

*Document g√©n√©r√© le 5 f√©vrier 2026*
*Projet ChatbotNaSoft - PFE NASOFT*
